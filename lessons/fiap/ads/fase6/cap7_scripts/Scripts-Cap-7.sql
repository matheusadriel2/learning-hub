--## SCRIPT PARA CRIAÇÃO DAS TABELAS

-- DROP TABLES
DROP TABLE T_INVESTIMENTOS    CASCADE CONSTRAINTS;
DROP TABLE T_TRANSACOES       CASCADE CONSTRAINTS;
DROP TABLE T_DIVIDAS          CASCADE CONSTRAINTS;
DROP TABLE T_CONTAS           CASCADE CONSTRAINTS;
DROP TABLE T_CARTOES          CASCADE CONSTRAINTS;
DROP TABLE T_USUARIO_LOGINS   CASCADE CONSTRAINTS;
DROP TABLE T_USUARIO_SENHAS   CASCADE CONSTRAINTS;
DROP TABLE T_USUARIO_DETALHES CASCADE CONSTRAINTS;
DROP TABLE T_USUARIOS         CASCADE CONSTRAINTS;

-- Tabela Usuários
CREATE TABLE T_USUARIOS (
	ID_USUARIO       			INTEGER         NOT NULL,
	NOME             			VARCHAR2(50)    NOT NULL,
	SOBRENOME        			VARCHAR2(50),
	EMAIL            			VARCHAR2(100),
	SALDO            			NUMBER(15,2),
	ESTA_VERIFICADO  			CHAR(1)         DEFAULT 'N',
	ESTA_ATIVO       			CHAR(1)         DEFAULT 'S',
	DT_CRIACAO       			DATE            DEFAULT SYSDATE,
	DT_ATUALIZACAO   			DATE,
	CONSTRAINT T_USUARIOS_PK PRIMARY KEY (ID_USUARIO)
);

-- Tabela Usuário Detalhes
CREATE TABLE T_USUARIO_DETALHES (
	ID_DETALHES            		INTEGER        NOT NULL,
	T_USUARIOS_ID_USUARIO  		INTEGER        NOT NULL,
	CPF                    		VARCHAR2(11),
	DT_NASCIMENTO          		DATE,
	GENERO                 		VARCHAR2(30),
	DT_CRIACAO             		DATE           DEFAULT SYSDATE,
	DT_ATUALIZACAO         		DATE,
	CONSTRAINT T_USUARIO_DETALHES_PK PRIMARY KEY (ID_DETALHES),
	CONSTRAINT T_USUARIO_DETALHES_T_USUARIOS_FK
		FOREIGN KEY (T_USUARIOS_ID_USUARIO)
		REFERENCES T_USUARIOS (ID_USUARIO)
);

-- Tabela Usuário Senhas
CREATE TABLE T_USUARIO_SENHAS (
	ID_SENHAS               	INTEGER        NOT NULL,
	T_USUARIOS_ID_USUARIO   	INTEGER        NOT NULL,
	SENHA                   	VARCHAR2(50)   NOT NULL,
	DT_CRIACAO              	DATE           DEFAULT SYSDATE,
	DT_ATUALIZACAO          	DATE,
	CONSTRAINT T_USUARIO_SENHAS_PK PRIMARY KEY (ID_SENHAS),
	CONSTRAINT T_USUARIO_SENHAS_T_USUARIOS_FK
		FOREIGN KEY (T_USUARIOS_ID_USUARIO)
		REFERENCES T_USUARIOS (ID_USUARIO)
);

-- Tabela Usuário Logins
CREATE TABLE T_USUARIO_LOGINS (
	ID_LOGIN               		INTEGER        NOT NULL,
	T_USUARIOS_ID_USUARIO  		INTEGER        NOT NULL,
	TIPO_LOGIN             		VARCHAR2(50)   NOT NULL,
	ULTIMO_LOGIN           		DATE,
	DT_CRIACAO             		DATE           DEFAULT SYSDATE,
	DT_ATUALIZACAO         		DATE,
	CONSTRAINT T_USUARIO_LOGINS_PK PRIMARY KEY (ID_LOGIN),
	CONSTRAINT T_USUARIO_LOGINS_T_USUARIOS_FK
		FOREIGN KEY (T_USUARIOS_ID_USUARIO)
		REFERENCES T_USUARIOS (ID_USUARIO)
);

-- Tabela Cartões
CREATE TABLE T_CARTOES (
	ID_CARTAO              		INTEGER        NOT NULL,
	T_USUARIOS_ID_USUARIO  		INTEGER        NOT NULL,
	TIPO_CARTAO            		VARCHAR2(50),
	NR_CARTAO              		VARCHAR2(16),
	VALIDADE               		DATE,
	BANDEIRA               		VARCHAR2(50),
	DT_CRIACAO             		DATE           DEFAULT SYSDATE,
	DT_ATUALIZACAO         		DATE,
	CONSTRAINT T_CARTOES_PK PRIMARY KEY (ID_CARTAO),
	CONSTRAINT T_CARTOES_T_USUARIOS_FK
		FOREIGN KEY (T_USUARIOS_ID_USUARIO)
		REFERENCES T_USUARIOS (ID_USUARIO)
);

-- Tabela Contas
CREATE TABLE T_CONTAS (
	ID_CONTA               		INTEGER        NOT NULL,
	T_USUARIOS_ID_USUARIO  		INTEGER        NOT NULL,
	NM_BANCO               		VARCHAR2(50),
	TIPO_CONTA             		VARCHAR2(50),
	NR_CONTA               		VARCHAR2(20),
	SALDO                  		VARCHAR2(20),
	DT_CRIACAO             		DATE           DEFAULT SYSDATE,
	DT_ATUALIZACAO         		DATE,
	CONSTRAINT T_CONTAS_PK PRIMARY KEY (ID_CONTA),
	CONSTRAINT T_CONTAS_T_USUARIOS_FK
		FOREIGN KEY (T_USUARIOS_ID_USUARIO)
		REFERENCES T_USUARIOS (ID_USUARIO)
);

-- Tabela Dívidas
CREATE TABLE T_DIVIDAS (
	ID_DIVIDA              		INTEGER        NOT NULL,
	T_USUARIOS_ID_USUARIO  		INTEGER        NOT NULL,
	NOME                   		VARCHAR2(50),
	VALOR_ORIGINAL         		VARCHAR2(20),
	VALOR_ATUAL            		VARCHAR2(20),
	DT_CRIACAO             		DATE           DEFAULT SYSDATE,
	DT_ATUALIZACAO         		DATE,
	CONSTRAINT T_DIVIDAS_PK PRIMARY KEY (ID_DIVIDA),
	CONSTRAINT T_DIVIDAS_T_USUARIOS_FK
		FOREIGN KEY (T_USUARIOS_ID_USUARIO)
		REFERENCES T_USUARIOS (ID_USUARIO)
);

-- Tabela Transações (Despesas e Receitas)
CREATE TABLE T_TRANSACOES (
	ID_TRANSACAO          		INTEGER        NOT NULL,
	T_USUARIOS_ID_USUARIO 		INTEGER 	   NOT NULL,
    T_CARTOES_ID_CARTAO   		INTEGER,
    T_CONTAS_ID_CONTA     		INTEGER,
    NM_TRANSACAO          		VARCHAR2(100)  NOT NULL,
    CD_TRANSACAO          		VARCHAR2(20),
    TIPO_TRANSACAO        		CHAR(1)        NOT NULL 
		CHECK (TIPO_TRANSACAO IN ('R','D')), -- 'R' Receita e 'D' Despesa
    VALOR                 		NUMBER(15,2)   NOT NULL,
    PGT_METODO            		VARCHAR2(50),
    NR_TRANSFERENCIA      		CHAR(1) 	   DEFAULT 'N',
    ESTA_AGENDADA         		CHAR(1)        DEFAULT 'N',
    DT_TRANSACAO          		DATE           DEFAULT SYSDATE,
	CONSTRAINT T_TRANSACOES_PK PRIMARY KEY (ID_TRANSACAO),
	CONSTRAINT T_TRANSACOES_FK_USR  FOREIGN KEY (T_USUARIOS_ID_USUARIO) REFERENCES T_USUARIOS(ID_USUARIO),
    CONSTRAINT T_TRANSACOES_FK_CART FOREIGN KEY (T_CARTOES_ID_CARTAO)   REFERENCES T_CARTOES(ID_CARTAO),
    CONSTRAINT T_TRANSACOES_FK_CONT FOREIGN KEY (T_CONTAS_ID_CONTA)     REFERENCES T_CONTAS(ID_CONTA)
);

-- Tabela Investimentos
CREATE TABLE T_INVESTIMENTOS (
    ID_TRANSACAO     			INTEGER        NOT NULL,
    TIPO_INVEST      			VARCHAR2(50),
    VALOR_APLICADO   			NUMBER(15,2),
    VALOR_ATUAL      			NUMBER(15,2),
    DT_APLICACAO     			DATE,
    DT_VENCIMENTO    			DATE,
    DT_ATUALIZACAO   			DATE,
	CONSTRAINT T_INVESTIMENTOS_PK PRIMARY KEY (ID_TRANSACAO),
    CONSTRAINT T_INVESTIMENTOS_FK
        FOREIGN KEY (ID_TRANSACAO) REFERENCES T_TRANSACOES(ID_TRANSACAO) ON DELETE CASCADE
);
-------------------------------------------------------
--## SCRIPTS CADASTRO E ALTERAÇÃO

-- 1. Cadastrar os dados do usuário:
-- 1.1. Cadastrar usuário com detalhes
INSERT INTO T_USUARIOS (ID_USUARIO, NOME, SOBRENOME, EMAIL, SALDO)
VALUES ([ID_USUARIO], '[NOME]', '[SOBRENOME]', '[EMAIL]', [SALDO]);

INSERT INTO T_USUARIO_DETALHES (ID_DETALHES, T_USUARIOS_ID_USUARIO, CPF, DT_NASCIMENTO, GENERO)
VALUES ([ID_DETALHES], [ID_USUARIO], '[CPF]', DATE '[AAAA-MM-DD]', '[GENERO]');

-- Exemplo:
INSERT INTO T_USUARIOS (ID_USUARIO, NOME, SOBRENOME, EMAIL, SALDO)
VALUES (
	1,
	'Galileo', 
	'Massi', 
	'galileo.massi@kofin.com', 
	250
);

INSERT INTO T_USUARIO_DETALHES (ID_DETALHES, T_USUARIOS_ID_USUARIO, CPF, DT_NASCIMENTO, GENERO)
VALUES (
	101,
	1,
	'14563104568',
	DATE '2024-06-10',
	'Masculino'
);

-- 1.2. Cadastrar usuário sem detalhes adicionais
INSERT INTO T_USUARIOS (ID_USUARIO, NOME, SOBRENOME, EMAIL, SALDO)
VALUES ([ID_USUARIO], '[NOME]', '[SOBRENOME]', '[EMAIL]', [SALDO]);

-- Exemplo:
INSERT INTO T_USUARIOS (ID_USUARIO, NOME, SOBRENOME, EMAIL, SALDO)
VALUES (
	2,
	'Darwin', 
	'Massi', 
	'darwin.massi@kofin.com', 
	200
);

-------------------------------------------------------
-- 2. Cadastrar os dados para a conta do usuário:
INSERT INTO T_CONTAS (ID_CONTA, T_USUARIOS_ID_USUARIO, NM_BANCO, TIPO_CONTA, NR_CONTA, SALDO)
VALUES ([ID_CONTA], [ID_USUARIO], '[BANCO]', '[TIPO]', '[NR_CONTA]', [SALDO_INICIAL]);

-- Exemplo:
INSERT INTO T_CONTAS (ID_CONTA, T_USUARIOS_ID_USUARIO, NM_BANCO, TIPO_CONTA, NR_CONTA, SALDO)
VALUES (
	101,
	1,
	'Banco Corrente',
	'Corrente',
	'31443-6',
	250);

INSERT INTO T_CONTAS (ID_CONTA, T_USUARIOS_ID_USUARIO, NM_BANCO, TIPO_CONTA, NR_CONTA, SALDO)
VALUES (
	201,
	2,
	'Banco Pupança',
	'Poupança',
	'21343-4',
	200);

-------------------------------------------------------
-- 3. Alterar todos os dados do usuário:
UPDATE T_USUARIOS
	SET NOME = '[NOVO_NOME]',
		SOBRENOME = '[NOVO_SOBRENOME]',
		EMAIL = '[NOVO_EMAIL]',
		SALDO = [NOVO_SALDO],
		ESTA_VERIFICADO = '[S|N]',
		DT_ATUALIZACAO = SYSDATE
WHERE ID_USUARIO = [ID_USUARIO];

UPDATE T_USUARIO_DETALHES
	SET CPF = '[NOVO_CPF]',
		DT_NASCIMENTO = DATE '[AAAA-MM-DD]',
		GENERO = '[GENERO]',
		DT_ATUALIZACAO = SYSDATE
WHERE T_USUARIOS_ID_USUARIO = [ID_USUARIO];

-- Exemplo:
UPDATE T_USUARIOS
	SET NOME = 'Matheus',
		SOBRENOME = 'Adriel',
		EMAIL = 'matheus.adriel@kofin.com',
		SALDO = 1000, 
		ESTA_VERIFICADO = 'S',
		DT_ATUALIZACAO = SYSDATE
WHERE ID_USUARIO = 1;

UPDATE T_USUARIO_DETALHES
	SET CPF = '12638761273',
		DT_NASCIMENTO = DATE '1999-11-10',
		GENERO = 'Masculino',
		DT_ATUALIZACAO = SYSDATE
WHERE T_USUARIOS_ID_USUARIO = 1;

-------------------------------------------------------
-- 4. Cadastrar as receitas do usuário:
INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES ([ID_TRANS], [ID_USR], [ID_CONTA], '[NOME_RECEITA]', '[COD_OPCIONAL]', 'R', [VALOR], '[METODO]', '[S|N]', '[S|N]', DATE '[AAAA-MM-DD]');

-- Exemplo (3 receitas):
INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES (101, 1, 101, 'Salário 20/03', 'SAL12B', 'R', 1500, 'Depósito', 'N', 'N', DATE '2025-03-20');

INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES (102, 1, 101, 'Freelance Caio', 'FRELLA21', 'R', 800, 'Transferência', 'S', 'N', SYSDATE);

INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES (103, 1, 101, 'Aniversário', 'GIFT312', 'R', 3000, 'PIX', 'N', 'N', DATE '2024-11-10');

-------------------------------------------------------
-- 5. Alterar todos os dados das receitas do usuário:
UPDATE T_TRANSACOES
	SET NM_TRANSACAO = '[NOVO_NOME]',
		CD_TRANSACAO = '[NOVO_COD]',
		VALOR        = [NOVO_VALOR],
		PGT_METODO   = '[METODO]',
		NR_TRANSFERENCIA = '[S|N]',
		ESTA_AGENDADA = '[S|N]',
		DT_TRANSACAO = DATE '[AAAA-MM-DD]'
 WHERE ID_TRANSACAO = [ID_RECEITA]
   AND TIPO_TRANSACAO = 'R';

-- Exemplo (alterando receita 101):
UPDATE T_TRANSACOES
	SET NM_TRANSACAO = 'Salário + Bônus 20/04',
		CD_TRANSACAO = 'SAL232',
		VALOR = 3500,
		PGT_METODO = 'PIX',
		NR_TRANSFERENCIA = 'S',
		ESTA_AGENDADA = 'S',
		DT_TRANSACAO = DATE '2025-04-20'
WHERE ID_TRANSACAO = 101
  AND TIPO_TRANSACAO = 'R';
  
-------------------------------------------------------
-- 6. Cadastrar as despesas do usuário:
INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES ([ID_TRANS], [ID_USR], [ID_CONTA], '[NOME_RECEITA]', '[COD_OPCIONAL]', 'D', [VALOR], '[METODO]', '[S|N]', '[S|N]', DATE '[AAAA-MM-DD]');

-- Exemplo (3 receitas):
INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES (200, 1, 101, 'Aluguel Março', 'ALUG23', 'D', 500, 'PIX', 'N', 'N', DATE '2025-03-27');

INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES (202, 1, 101, 'Conta de Luz', 'CONDGY2', 'D', 80, 'PIX', 'N', 'N', DATE '2025-03-25');

INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES (203, 1, 101, 'God of War Jogo Steam', 'GAME213', 'D', 300, 'PIX', 'N', 'N', DATE '2025-03-21');

-------------------------------------------------------
-- 7. Alterar todos os dados das despesas do usuário:
UPDATE T_TRANSACOES
	SET NM_TRANSACAO = '[NOVO_NOME]',
		CD_TRANSACAO = '[NOVO_COD]',
		VALOR = [NOVO_VALOR],
		PGT_METODO = '[METODO]',
		NR_TRANSFERENCIA = '[S|N]',
		ESTA_AGENDADA = '[S|N]',
		DT_TRANSACAO = DATE '[AAAA-MM-DD]'
 WHERE ID_TRANSACAO = [ID_RECEITA]
   AND TIPO_TRANSACAO = 'D';

-- Exemplo (alterando receita 200):
UPDATE T_TRANSACOES
	SET NM_TRANSACAO = 'Aluguel Abril',
		CD_TRANSACAO = 'ALUG24',
		VALOR = 400,
		PGT_METODO = 'DINHEIRO',
		NR_TRANSFERENCIA = 'S',
		ESTA_AGENDADA = 'S',
		DT_TRANSACAO = DATE '2025-04-28'
WHERE ID_TRANSACAO = 200
  AND TIPO_TRANSACAO = 'D';
  
-------------------------------------------------------
-- 8. Cadastrar os dados para investimentos:
-- Esse tipo de transação precisa de um registro base na tabela T_TRANSACOES
INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO)
VALUES ([ID_TRANS], [ID_USR], [ID_CONTA],'[NOME_INVEST]', '[COD_OPCIONAL]', 'R', [VALOR_APLICADO], 'Investimento');

-- E na tabela T_INVESTIMENTOS
INSERT INTO T_INVESTIMENTOS (ID_TRANSACAO, TIPO_INVEST, VALOR_APLICADO, VALOR_ATUAL, DT_APLICACAO, DT_VENCIMENTO)
VALUES ([ID_TRANS], '[TIPO]', [VALOR_APLICADO], [VALOR_ATUAL], SYSDATE, DATE '[AAAA-MM-DD]');

-- Exemplo:
INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES ( 701, 1, 101, 'CDB BTG 105', 'INSV2', 'R', 2000, 'Investimento', 'N', 'S', SYSDATE);
INSERT INTO T_INVESTIMENTOS (ID_TRANSACAO, TIPO_INVEST, VALOR_APLICADO, VALOR_ATUAL, DT_APLICACAO, DT_VENCIMENTO)
VALUES ( 701, 'CDB', 2000, 2000, SYSDATE, DATE '2027-12-31');

INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES ( 702, 1, 101, 'CDI PAN 232', 'INSV3', 'R', 3000, 'Investimento', 'N', 'S', SYSDATE);
INSERT INTO T_INVESTIMENTOS (ID_TRANSACAO, TIPO_INVEST, VALOR_APLICADO, VALOR_ATUAL, DT_APLICACAO, DT_VENCIMENTO)
VALUES ( 702, 'CDI', 1500, 233.21, SYSDATE, DATE '2025-06-30');

INSERT INTO T_TRANSACOES (ID_TRANSACAO, T_USUARIOS_ID_USUARIO, T_CONTAS_ID_CONTA, NM_TRANSACAO, CD_TRANSACAO, TIPO_TRANSACAO, VALOR, PGT_METODO, NR_TRANSFERENCIA, ESTA_AGENDADA, DT_TRANSACAO)
VALUES ( 703, 1, 101, 'Tesouro Selic 2029', 'INSV5', 'R', 5000, 'Investimento', 'N', 'S', SYSDATE);
INSERT INTO T_INVESTIMENTOS (ID_TRANSACAO, TIPO_INVEST, VALOR_APLICADO, VALOR_ATUAL, DT_APLICACAO, DT_VENCIMENTO)
VALUES ( 703, 'SELIC', 5000, 5000, SYSDATE, DATE '2029-03-01');

-------------------------------------------------------
-- 9. Alterar todos os dados para investimentos do usuário, utilizando o código como referência.

UPDATE T_INVESTIMENTOS
	SET TIPO_INVEST    = '[NOVO_TIPO]',
		VALOR_APLICADO = [NOVO_VALOR_APLICADO],
		VALOR_ATUAL    = [NOVO_VALOR_ATUAL],
		DT_APLICACAO   = DATE '[AAAA-MM-DD]',
		DT_ATUALIZACAO = SYSDATE
WHERE ID_TRANSACAO = [ID_INVEST];

UPDATE T_TRANSACOES
	SET NM_TRANSACAO = '[NOVO_NOME]',
		CD_TRANSACAO = '[NOVO_COD]',
		VALOR        = [NOVO_VALOR],
		PGT_METODO   = '[METODO]',
		NR_TRANSFERENCIA = '[S|N]',
		ESTA_AGENDADA = '[S|N]',
		DT_TRANSACAO = DATE '[AAAA-MM-DD]'
WHERE ID_TRANSACAO = [ID_INVEST]

-- Exemplo (alterando transação 701):
UPDATE T_INVESTIMENTOS
	SET TIPO_INVEST    = 'CDI',
		VALOR_APLICADO = 2500,
		VALOR_ATUAL    = 2500,
		DT_APLICACAO   = DATE '2026-02-15',
		DT_ATUALIZACAO = SYSDATE
WHERE ID_TRANSACAO = 701;

UPDATE T_TRANSACOES
	SET NM_TRANSACAO = 'CDI BTG 102',
		CD_TRANSACAO = 'INSV3',
		VALOR        = 2500,
		PGT_METODO   = 'Investimento',
		NR_TRANSFERENCIA = 'N',
		ESTA_AGENDADA = 'S',
		DT_TRANSACAO = DATE '2025-03-12'
WHERE ID_TRANSACAO = 701;

-------------------------------------------------------
--## SCRIPT CONSULTAS

-- 1. Consultar os dados de um usuário
-- 1.1. Somente dados da tabela T_USUARIOS
SELECT *
FROM T_USUARIOS
WHERE ID_USUARIO = [ID_USUARIO];

-- Exemplo:
SELECT *
FROM T_USUARIOS
WHERE ID_USUARIO = 1;

-- 1.2. Dados do usuário com detalhes
SELECT *
FROM T_USUARIOS U
JOIN T_USUARIO_DETALHES D 
  ON D.T_USUARIOS_ID_USUARIO = U.ID_USUARIO
WHERE U.ID_USUARIO = [ID_USUARIO];

-- Exemplo:
SELECT *
FROM T_USUARIOS U
JOIN T_USUARIO_DETALHES D 
  ON D.T_USUARIOS_ID_USUARIO = U.ID_USUARIO
WHERE U.ID_USUARIO = 1;

-- 1.3. [CASO ADICIONAL] Listar todos os usuários ordenados por nome
SELECT *
FROM T_USUARIOS
ORDER BY NOME;

-------------------------------------------------------
-- 2. Consultar os dados de um único registro de despesa de um usuário
SELECT *
FROM T_TRANSACOES
WHERE T_USUARIOS_ID_USUARIO = [ID_USUARIO]
  AND ID_TRANSACAO = [ID_DESPESA]
  AND TIPO_TRANSACAO = 'D';

-- Exemplo (despesa 200 do usuário 1):
SELECT *
FROM T_TRANSACOES
WHERE T_USUARIOS_ID_USUARIO = 1
  AND ID_TRANSACAO = 200
  AND TIPO_TRANSACAO = 'D';

-------------------------------------------------------
-- 3. Consultar os dados de todos os registros de despesas de um usuário
--    Nota: Ordenando-os dos registros mais recentes para os mais antigos

SELECT *
FROM T_TRANSACOES
WHERE T_USUARIOS_ID_USUARIO = [ID_USUARIO]
  AND TIPO_TRANSACAO = 'D'
ORDER BY DT_TRANSACAO DESC;

-- Exemplo (todas as despesas do usuário 1, ordem decrescente):
SELECT *
FROM T_TRANSACOES
WHERE T_USUARIOS_ID_USUARIO = 1
  AND TIPO_TRANSACAO = 'D'
ORDER BY DT_TRANSACAO DESC;

------------------------------------------------------------------------------
-- 4. Consultar os dados de um único registro de investimento de um  usuário
SELECT *
FROM T_TRANSACOES T
JOIN T_INVESTIMENTOS I 
  ON I.ID_TRANSACAO = T.ID_TRANSACAO
WHERE T.T_USUARIOS_ID_USUARIO = [ID_USUARIO]
  AND T.ID_TRANSACAO = [ID_INVESTIMENTO];

-- Exemplo (investimento 701 do usuário 1):
SELECT *
FROM T_TRANSACOES T
JOIN T_INVESTIMENTOS I 
  ON I.ID_TRANSACAO = T.ID_TRANSACAO
WHERE T.T_USUARIOS_ID_USUARIO = 1
  AND T.ID_TRANSACAO = 701;

------------------------------------------------------------------------------
-- 5. Consultar os dados de todos os registros de investimentos de um  usuário, 
--    Nota: Ordenando-os dos registros mais recentes para os mais antigos
SELECT *
FROM T_TRANSACOES T
JOIN T_INVESTIMENTOS I
  ON I.ID_TRANSACAO = T.ID_TRANSACAO
WHERE T.T_USUARIOS_ID_USUARIO = [ID_USUARIO]
ORDER BY T.DT_TRANSACAO DESC;

-- Exemplo (todos os investimentos do usuário 1):
SELECT *
FROM T_TRANSACOES T
JOIN T_INVESTIMENTOS I 
  ON I.ID_TRANSACAO = T.ID_TRANSACAO
WHERE T.T_USUARIOS_ID_USUARIO = 1
ORDER BY T.DT_TRANSACAO DESC;

------------------------------------------------------------------------------
-- 6. Consultar os dados básicos de um usuário, o último investimento registrado e a última despesa registrada
SELECT 
	U.ID_USUARIO,
	U.NOME,
	U.EMAIL,
	U.SALDO,
	(SELECT MAX(DT_TRANSACAO)
	FROM T_TRANSACOES
	WHERE T_USUARIOS_ID_USUARIO = U.ID_USUARIO
	  AND TIPO_TRANSACAO = 'D'
	) AS ULTIMA_DESPESA,
	(SELECT MAX(T.DT_TRANSACAO)
	FROM T_TRANSACOES T
	WHERE T.T_USUARIOS_ID_USUARIO = U.ID_USUARIO
	  AND T.ID_TRANSACAO IN (
		  SELECT ID_TRANSACAO 
		  FROM T_INVESTIMENTOS)
	) AS ULTIMO_INVEST
FROM T_USUARIOS U
WHERE U.ID_USUARIO = [ID_USUARIO];

-- Exemplo (usuário 1):
SELECT 
	U.ID_USUARIO,
	U.NOME,
	U.EMAIL,
	U.SALDO,
	(SELECT MAX(DT_TRANSACAO)
	FROM T_TRANSACOES
	WHERE T_USUARIOS_ID_USUARIO = U.ID_USUARIO
	  AND TIPO_TRANSACAO = 'D'
	) AS ULTIMA_DESPESA,
	(SELECT MAX(T.DT_TRANSACAO)
	FROM T_TRANSACOES T
	WHERE T.T_USUARIOS_ID_USUARIO = U.ID_USUARIO
	  AND T.ID_TRANSACAO IN (
		  SELECT ID_TRANSACAO 
		  FROM T_INVESTIMENTOS)
	) AS ULTIMO_INVEST
FROM T_USUARIOS U
WHERE U.ID_USUARIO = 1;
